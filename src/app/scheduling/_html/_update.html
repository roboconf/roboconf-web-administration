
<rbcf-menu></rbcf-menu>

<div class="content">
	<h1>
		Scheduler &raquo; {{ job.name }}
		<img src="img/spinner.gif" class="spinner" alt="..." ng-show="responseStatus === -1" />
	</h1>
</div>

<div class="menu">
	<ul>
		<li><a href="#/scheduler">Scheduled Jobs</a></li>
		<li class="active"><a href="#/scheduler/job/{{ job.id }}">Properties</a></li>
		<li><a href="#/scheduler/job/{{ job.id }}/delete">Delete</a></li>
	</ul>
</div>

<div class="content short-content">

	<!-- Error message -->
	<rbcf-error-message ng-show="responseStatus > 0 && responseStatus !== 404"></rbcf-error-message>

	<!-- Job properties -->
	<form novalidate name="newJobForm" ng-show="responseStatus === 0">

		<!-- Job name -->
		<div class="form-group" ng-class="{'has-error': newJobForm.jobname.$invalid && newJobForm.jobname.$dirty}">
			<label for="name" class="control-label">Job name</label>
			<span class="r-help" ng-show="newJobForm.name.$error.required">(required)</span><br />
			<input type="text" class="form-control" name="name" placeholder="a name" ng-model="job.name" ng-readonly="! editMode" required>
		</div>

		<!-- App name -->
		<div class="form-group" ng-class="{'has-error': newJobForm.appname.$invalid && newJobForm.appname.$dirty}">
			<label for="appname" class="control-label">Application name</label>
			<span class="r-help" ng-show="newJobForm.appname.$error.required">(required)</span><br />
			<select name="appname" class="form-control" required
					ng-model="job.app"
					ng-options="app.name for app in apps track by app.name"
					ng-change="loadCommands()"
					ng-show="editMode">
			</select>
			
			<input type="text" class="form-control" ng-hide="editMode" ng-model="job.app.name" required readonly>
		</div>

		<!-- Command name -->
		<div class="form-group" ng-class="{'has-error': newJobForm.cmdname.$invalid && newJobForm.cmdname.$dirty}">
			<label for="cmdname" class="control-label">Command name</label>
			<span class="r-help" ng-show="newJobForm.cmdname.$error.required">(required)</span><br />
			<select name="cmdname" class="form-control" required
					ng-model="job.cmdName"
					ng-options="cmd for cmd in cmdNames"
					ng-show="editMode">
			</select>
			
			<input type="text" class="form-control" ng-hide="editMode" ng-model="job.cmdName" required readonly>
		</div>

		<!-- CRON (read-only) -->
		<div class="form-group" ng-hide="editMode">
			<label>
				The <a href="https://fr.wikipedia.org/wiki/Cron">CRON expression</a> for the schedule.
			</label>
			<br />
			<input type="text" class="form-control" ng-model="job.cron" required readonly>
		</div>

		<!-- CRON (edition) -->
		<div class="form-group" ng-show="editMode">
			<label>
				Please, type in a <a href="https://fr.wikipedia.org/wiki/Cron">CRON expression</a> to setup the schedule.
				<span class="r-help" ng-show="newJobForm.cron.$error.required">(required)</span>
				<span class="r-help" ng-show="job.cron && cronIsInvalid()">(must contain either between 6 and 7 fields)</span>
				<br />
				You can use <a href="" ng-click="showCronEditor = true">our simplified CRON editor</a>.
			</label>
			
			<input type="text" class="form-control" name="cron" 
					placeholder="a CRON expression (e.g. to trigger a command every day: 0 0 * * *)" 
					ng-model="job.cron" required>
		</div>
		
		<div class="form-group">
			<label ng-show="showCronEditor"><a href="" ng-click="showCronEditor = false">Hide</a> our simplified CRON editor.</label>
			<cron-selection output="job.cron" config="cronEditorConfig" ng-show="showCronEditor"></cron-selection>
		</div>
	
		<p id="new-job-error" class="bg-danger" ng-show="errorMessage">{{ errorMessage }}</p>
		<button type="submit" class="btn btn-default pull-right" ng-hide="editMode" ng-click="startEdit()">Edit</button>
		<button type="submit" class="btn btn-default pull-right" ng-disabled="! newJobForm.$valid" ng-show="editMode" ng-click="completeEdit()">
			Submit
		</button>
		<button type="submit" class="btn btn-default pull-right" ng-show="editMode" ng-click="cancelEdit()">Cancel</button>
	</form>
	
	<div ng-show="responseStatus === 404">No job with this ID was found (<strong>{{ job.id }}</strong>).</div>
</div>
